{% extends "base.html" %}
{% block content %}

<h2 class="mb-4">Editar Pago</h2>

<div class="card shadow p-4">

    <form method="POST">

        <!-- SOCIO -->
        <div class="mb-3">
            <label class="form-label">Socio:</label>
            <select name="id_socio" class="form-control" required>
                {% for s in socios %}
                <option value="{{ s.id_socio }}" 
                        {% if s.id_socio == pago.id_socio %}selected{% endif %}>
                    {{ s.nombre }} {{ s.apellido }}
                </option>
                {% endfor %}
            </select>
        </div>

        <!-- PLAN -->
        <div class="mb-3">
            <label class="form-label">Plan:</label>
            <select id="id_plan" name="id_plan" class="form-control" required>
                {% for p in planes %}
                <option value="{{ p.id_plan }}"
                        {% if p.id_plan == pago.id_plan %}selected{% endif %}>
                    {{ p.nombre_plan }}
                </option>
                {% endfor %}
            </select>
        </div>

        <!-- FECHA INICIO -->
        <div class="mb-3">
            <label class="form-label">Fecha Inicio:</label>
            <input type="date" id="fecha_inicio" name="fecha_inicio"
                   class="form-control" value="{{ pago.fecha_inicio }}" required>
        </div>

        <!-- FECHA FIN -->
        <div class="mb-3">
            <label class="form-label">Fecha Fin:</label>
            <input type="date" id="fecha_fin" name="fecha_fin"
                   class="form-control" value="{{ pago.fecha_fin }}" readonly required>
        </div>

        <!-- MONTO -->
        <div class="mb-3">
            <label class="form-label">Monto (Bs.):</label>
            <input type="number" id="monto" name="monto"
                   class="form-control" value="{{ pago.monto }}" readonly required>
        </div>

        <button class="btn btn-primary">Guardar Cambios</button>
        <a href="{{ url_for('pagos_lista') }}" class="btn btn-secondary">Cancelar</a>

    </form>

</div>


<!-- SCRIPT PARA AUTOCOMPLETAR -->
<script>
    const datosPlanes = {
        1: { dias: 30, precio: 100 },
        2: { dias: 90, precio: 250 },
        3: { dias: 180, precio: 450 },
        4: { dias: 365, precio: 800 }
    };

    document.getElementById("id_plan").addEventListener("change", function() {
        const id = this.value;

        if (id in datosPlanes) {
            document.getElementById("monto").value = datosPlanes[id].precio;

            const inicio = document.getElementById("fecha_inicio").value;
            if (inicio) {
                const f = new Date(inicio);
                f.setDate(f.getDate() + datosPlanes[id].dias);
                document.getElementById("fecha_fin").value = f.toISOString().substring(0, 10);
            }
        }
    });

    document.getElementById("fecha_inicio").addEventListener("change", function() {
        const planId = document.getElementById("id_plan").value;

        if (planId in datosPlanes) {
            const f = new Date(this.value);
            f.setDate(f.getDate() + datosPlanes[planId].dias);
            document.getElementById("fecha_fin").value = f.toISOString().substring(0, 10);
        }
    });
</script>

{% endblock %}
