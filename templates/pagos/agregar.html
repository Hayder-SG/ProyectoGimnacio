{% extends "base.html" %}
{% block content %}

<h2 class="mb-4">Registrar Pago</h2>

<div class="card shadow p-4">

    <form method="POST">

        <!-- SOCIO -->
        <div class="mb-3">
            <label class="form-label">Socio:</label>
            <select name="id_socio" class="form-control" required>
                <option value="">Seleccione...</option>
                {% for s in socios %}
                    <option value="{{ s.id_socio }}">{{ s.nombre }} {{ s.apellido }}</option>
                {% endfor %}
            </select>
        </div>

        <!-- PLAN -->
        <div class="mb-3">
            <label class="form-label">Plan:</label>
            <select id="id_plan" name="id_plan" class="form-control" required>
                <option value="">Seleccione...</option>
                {% for p in planes %}
                <option value="{{ p.id_plan }}">{{ p.nombre_plan }}</option>
                {% endfor %}
            </select>
        </div>

        <!-- FECHA INICIO -->
        <div class="mb-3">
            <label class="form-label">Fecha Inicio:</label>
            <input type="date" id="fecha_inicio" name="fecha_inicio" class="form-control" required>
        </div>

        <!-- FECHA FIN (AUTOMÁTICO) -->
        <div class="mb-3">
            <label class="form-label">Fecha Fin:</label>
            <input type="date" id="fecha_fin" name="fecha_fin" class="form-control" readonly required>
        </div>

        <!-- MONTO (AUTOMÁTICO) -->
        <div class="mb-3">
            <label class="form-label">Monto (Bs.):</label>
            <input type="number" id="monto" name="monto" class="form-control" readonly required>
        </div>

        <button class="btn btn-primary">Registrar Pago</button>
        <a href="{{ url_for('pagos_lista') }}" class="btn btn-secondary">Cancelar</a>

    </form>

</div>

<!-- SCRIPT DE AUTOCOMPLETADO -->
<script>
    const datosPlanes = {
        1: { dias: 30, precio: 100 },
        2: { dias: 90, precio: 250 },
        3: { dias: 180, precio: 450 },
        4: { dias: 365, precio: 800 }
    };

    // Cuando cambia el plan
    document.getElementById("id_plan").addEventListener("change", function() {
        const id = this.value;

        if (id in datosPlanes) {
            document.getElementById("monto").value = datosPlanes[id].precio;

            const fechaInicio = document.getElementById("fecha_inicio").value;
            if (fechaInicio) {
                const f = new Date(fechaInicio);
                f.setDate(f.getDate() + datosPlanes[id].dias);
                document.getElementById("fecha_fin").value = f.toISOString().substring(0, 10);
            }
        }
    });

    // Recalcular fecha FIN si cambia fecha de inicio
    document.getElementById("fecha_inicio").addEventListener("change", function() {
        const planId = document.getElementById("id_plan").value;

        if (planId in datosPlanes) {
            const f = new Date(this.value);
            f.setDate(f.getDate() + datosPlanes[planId].dias);
            document.getElementById("fecha_fin").value = f.toISOString().substring(0, 10);
        }
    });
</script>

{% endblock %}
